<!DOCTYPE html>
<html>
<head>
    <title>Registro - Unete al equipo</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .form-group { 
            margin-bottom: 15px; 
        }
        label { 
            display: block; 
            margin-bottom: 5px; 
        }
        input, select { 
            width: 100%; 
            padding: 8px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
        }
        button { 
            background-color: #25D366; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        .qr-section { 
            text-align: center; 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
        }
        .qr-image { 
            max-width: 200px; 
            margin: 10px auto; 
        }
        .link-section {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>Únete al equipo</h1>
    
    <form action="/registro" method="POST">
        <div class="form-group">
            <label for="lider">Selecciona tu líder:</label>
            <select id="lider" name="lider" onchange="actualizarQR()">
                <option value="">-- Selecciona un líder --</option>
                {% for id, nombre in lideres.items() %}
                    <option value="{{ id }}" {% if lider_seleccionado == id %}selected{% endif %}>
                        {{ nombre }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Sección del QR (se muestra solo cuando se selecciona un líder) -->
        <div id="qrSection" class="qr-section" style="display: none;">
            <h3>Escanea el QR para compartir</h3>
            <div id="qrContainer">
                <!-- El QR se cargará aquí -->
            </div>
            <div class="link-section">
                <strong>Link directo:</strong><br>
                <span id="directLink"></span>
                <button type="button" onclick="copiarLink()">Copiar Link</button>
            </div>
        </div>

        <div class="form-group">
            <label for="nombre">Nombre completo:</label>
            <input type="text" id="nombre" name="nombre" required>
        </div>

        <div class="form-group">
            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" required>
        </div>

        <div class="form-group">
            <label for="edad">Edad:</label>
            <input type="number" id="edad" name="edad" required>
        </div>

        <div class="form-group">
            <label for="nacimiento">Fecha de nacimiento:</label>
            <input type="date" id="nacimiento" name="nacimiento" required>
        </div>

        <button type="submit">Unirse al grupo de WhatsApp</button>
    </form>

    <script>
        function actualizarQR() {
            const liderSelect = document.getElementById('lider');
            const liderId = liderSelect.value;
            const qrSection = document.getElementById('qrSection');
            const qrContainer = document.getElementById('qrContainer');
            const directLink = document.getElementById('directLink');

            if (liderId) {
                // Mostrar sección del QR
                qrSection.style.display = 'block';
                
                // Generar URL del formulario con el líder seleccionado
                const baseUrl = window.location.origin;
                const formUrl = `${baseUrl}/?lider=${liderId}`;
                
                // Actualizar link directo
                directLink.textContent = formUrl;
                
                // Cargar imagen QR
                qrContainer.innerHTML = `<img src="/qr/${liderId}" alt="QR Code" class="qr-image">`;
            } else {
                qrSection.style.display = 'none';
            }
        }

        function copiarLink() {
            const linkText = document.getElementById('directLink').textContent;
            navigator.clipboard.writeText(linkText).then(function() {
                alert('Link copiado al portapapeles!');
            });
        }

        // Inicializar QR si ya hay un líder seleccionado
        document.addEventListener('DOMContentLoaded', function() {
            const liderSelect = document.getElementById('lider');
            if (liderSelect.value) {
                actualizarQR();
            }
        });
    </script>
</body>
</html>